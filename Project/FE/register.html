<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Đăng ký tài khoản</title>
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css"> -->
  <link rel="stylesheet" type="text/css" href="icomoon/icomoon.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/vendor.css">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<style>
  #register-form {
    max-width: 500px;
    margin: 60px auto;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    padding: 40px 30px;
    font-family: 'Raleway', sans-serif;
    color: #333;
  }

  #register-form h2 {
    font-family: 'Prata', serif;
    font-size: 28px;
    margin-bottom: 25px;
    text-align: center;
    color: #2f2f2f;
  }

  #register-form input[type="text"],
  #register-form input[type="password"],
  #register-form input[type="email"],
  #register-form input[type="file"] {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 18px;
    font-size: 15px;
    background-color: #f9f9f9;
    transition: border 0.2s ease-in-out;
  }

  #register-form input:focus {
    border-color: #C5A992;
    outline: none;
    background-color: #fff;
  }

  #register-form label {
    font-weight: 600;
    margin-bottom: 6px;
    display: inline-block;
    color: #555;
  }

  #avatarPreview {
    width: 100px;
    border-radius: 50%;
    margin-top: 10px;
    margin-bottom: 10px;
    border: 2px solid #eee;
    display: block;
  }

  #clearAvatarBtn {
    background-color: #eee;
    border: none;
    color: #444;
    font-size: 14px;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 10px;
  }

  #clearAvatarBtn:hover {
    background-color: #ddd;
  }

  #register-form button[type="submit"] {
    width: 100%;
    background-color: #C5A992;
    border: none;
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    transition: background-color 0.3s ease;
    margin-top: 15px;
  }

  #register-form button[type="submit"]:hover {
    background-color: #a38470;
  }

  #register-result {
    margin-top: 15px;
    font-weight: bold;
    color: #28a745;
    text-align: center;
  }
</style>

<body>
  <!-- <h2>Đăng ký</h2> -->

  <div id="header-placeholder"></div>

  <form id="register-form">
    <input class="form-control" type="text" placeholder="Tên người dùng" name="username" required><br>
    <input class="form-control" type="password" placeholder="Mật khẩu" name="password" required><br>
    <input class="form-control" type="text" placeholder="Họ tên" name="name" required><br>
    <input class="form-control" type="email" placeholder="Email" name="email" required><br>
    <input class="form-control" type="text" placeholder="Số điện thoại" name="phone" required><br>
    <input class="form-control" type="text" placeholder="Địa chỉ" name="address" required><br><br>

    <!-- Chọn ảnh từ máy -->
    <label>Chọn ảnh từ máy:</label><br>
    <input class="form-control" type="file" name="avatarFile" accept="image/*" id="avatarFile"><br><br>

    <!-- Hoặc link ảnh -->
    <label>Hoặc dán link ảnh (URL):</label><br>
    <input class="form-control" type="text" name="avatarUrl" id="avatarUrl" placeholder="https://..."
      autocomplete="off"><br><br>

    <!-- Xem trước ảnh -->
    <img id="avatarPreview" src="" alt="Preview" width="100" style="display:none"><br>
    <button type="button" id="clearAvatarBtn" style="display:none">Xoá ảnh</button><br><br>

    <button type="submit">Đăng ký</button>
  </form>

  <p id="register-result"></p>

  <div id="footer-placeholder"></div>
  <div id="footer-bottom-placeholder"></div>

  <script src="js/jquery-1.11.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script src="js/plugins.js"></script>
  <script src="js/script.js"></script>

  <script src="assets/js/general.js" type="module"></script>



  <script>
    const avatarFileInput = document.getElementById("avatarFile");
    const avatarUrlInput = document.getElementById("avatarUrl");
    const avatarPreview = document.getElementById("avatarPreview");
    const clearAvatarBtn = document.getElementById("clearAvatarBtn");

    avatarFileInput.addEventListener("change", function () {
      const file = avatarFileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          avatarPreview.src = e.target.result;
          avatarPreview.style.display = "block";
          clearAvatarBtn.style.display = "inline-block";
        };
        reader.readAsDataURL(file);
      }
    });

    avatarUrlInput.addEventListener("input", function () {
      const url = avatarUrlInput.value.trim();
      if (url.startsWith("http")) {
        avatarPreview.src = url;
        avatarPreview.style.display = "block";
        clearAvatarBtn.style.display = "inline-block";
      } else {
        avatarPreview.src = "";
        avatarPreview.style.display = "none";
        clearAvatarBtn.style.display = "none";
      }
    });

    clearAvatarBtn.addEventListener("click", function () {
      avatarPreview.src = "";
      avatarPreview.style.display = "none";
      clearAvatarBtn.style.display = "none";
      avatarFileInput.value = "";
      avatarUrlInput.value = "";
    });

    document.getElementById("register-form").addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;
      const fileInput = form.avatarFile.files[0];
      const avatarUrl = form.avatarUrl.value.trim();

      const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });

      let avatar = "";
      if (fileInput) {
        avatar = await toBase64(fileInput);
      } else if (avatarUrl !== "") {
        avatar = avatarUrl;
      }

      const data = {
        username: form.username.value,
        password: form.password.value,
        name: form.name.value,
        email: form.email.value,
        phone: form.phone.value,
        address: form.address.value,
        avatar: avatar,
        isActive: true
      };

      const res = await fetch("http://localhost:8080/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.text();
      document.getElementById("register-result").textContent = result;
    });
  </script>


</body>

</html>